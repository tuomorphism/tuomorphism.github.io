{% extends 'markdown/index.md.j2' %}

{# -------- Minimal frontmatter (with frontSlug) -------- #}
{%- block header -%}
---
title: "{{ resources.metadata.get('title', 'Untitled') }}"
publishDate: {{ resources.metadata.get('publishDate', '') }}
frontSlug: "{{ resources.metadata.get('frontSlug', '') }}"
---
{%- endblock header -%}

{# -------- Optional Table of Contents (no FM fields needed) -------- #}
{%- block before_body -%}
{%- set toc_items = resources.metadata.get('toc_items') -%}
{%- if toc_items and toc_items|length > 0 -%}
<nav class="toc">
  <h2>Table of contents</h2>
  <ul>
    {%- for item in toc_items -%}
    <li style="margin-left: {{ (item.level - 1) * 1.0 }}rem">
      <a href="#{{ item.id }}">{{ item.text }}</a>
    </li>
    {%- endfor -%}
  </ul>
</nav>
<hr/>
{%- endif -%}
{%- endblock before_body -%}

{# -------- Output rendering (unchanged behavior) -------- #}
{%- block traceback_line -%}
<pre><code class="language-output">{{ line | trim | e }}</code></pre>
{%- endblock traceback_line -%}

{%- block stream -%}
<pre><code class="language-output">{{ output.text | trim | e }}</code></pre>
{%- endblock stream -%}

{%- block error -%}
<pre><code class="language-output">{{ (output.ename ~ ': ' ~ output.evalue) | e }}
{%- for line in output.traceback -%}
{{ line | trim | e }}
{%- endfor %}</code></pre>
{%- endblock error -%}

{%- block execute_result -%}
{%- if 'text/plain' in output.data -%}
<pre><code class="language-output">{{ output.data['text/plain'] | trim | e }}</code></pre>
{%- else -%}
{{ super() }}
{%- endif -%}
{%- endblock execute_result -%}

{%- block display_data -%}
{%- if 'text/plain' in output.data and output.data|length == 1 -%}
<pre><code class="language-output">{{ output.data['text/plain'] | trim | e }}</code></pre>
{%- else -%}
<div class="nb-output">
  {{ super() }}  {# keep default rendering & asset extraction #}
</div>
{%- endif -%}
{%- endblock display_data -%}
